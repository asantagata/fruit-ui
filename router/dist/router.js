import{replaceWith}from"https://cdn.jsdelivr.net/npm/@fruit-ui/core@latest/src/index.js";const PARAM_NAME="page";function getPage(){const params=new URLSearchParams(window.location.search);return params.get(PARAM_NAME)??""}function getRoute(routes,page){if(routes[page])return routes[page];if(routes[`/${page}`])return routes[`/${page}`];if(routes["*"])return routes["*"];if(routes["/*"])return routes["/*"];return{}}function Router(routes){return{render(){const page=getPage();const route=getRoute(routes,page);let element=(()=>{if(Object.getPrototypeOf(route.route).constructor.name==="AsyncFunction"){route.route(page).then(v=>{replaceWith(this.element.firstChild,v)});return{}}else{return route.route(page)}})();return{children:typeof element==="object"?{...element,key:page}:element,id:"router",dataset:{receivePageChanges:true},on:{pagechange(){const page=getPage();const route=getRoute(routes,page);if(Object.getPrototypeOf(route.route).constructor.name==="AsyncFunction"){route.route(page).then(v=>{replaceWith(this.element.firstChild,v)})}else{this.rerender()}document.title=getRoute(routes,getPage()).title??document.title},mount(){window.onpopstate=()=>broadcastPageChange(getPage());document.title=route.title??document.title}}}},memo:{page:getPage()}}}function navigate(page){if(page.startsWith("/"))page=page.slice(1);if(page===getPage())return;const url=new URL(window.location.href);url.searchParams.set(PARAM_NAME,page);window.history.pushState({},"",url);broadcastPageChange(page)}function broadcastPageChange(page){const event=new CustomEvent("pagechange",{detail:{page:page}});Array.from(document.querySelectorAll(`[data-receive-page-changes]`)).forEach(target=>{target.dispatchEvent(event)})}export{navigate,Router,getPage};